<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>RNE Visual | A.010 + G.040</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['Roboto Mono', 'monospace'] },
          colors: {
            brand: { dark: '#0f172a', blue: '#002855', red: '#DA291C', yellow: '#FFC72C', gray: '#f1f5f9' }
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
    
    /* UTILS */
    .view-section { display: none; }
    .view-section.active { display: block; animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* CUSTOM INPUTS */
    select, input { appearance: none; }
    .input-box { @apply w-full p-3 bg-white border border-slate-300 rounded-lg text-sm font-bold text-brand-blue focus:ring-2 focus:ring-brand-blue outline-none transition-shadow; }
    .label-box { @apply block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1; }

    /* NAVBAR ACTIVE STATE */
    .nav-btn.active { @apply text-brand-blue; }
    .nav-btn.active i { @apply animate-bounce; }
  </style>
</head>
<body class="pb-24 md:pb-0 bg-slate-100 text-slate-800">

  <nav class="fixed bottom-0 md:top-0 w-full bg-white/95 backdrop-blur z-50 border-t md:border-b border-slate-200 shadow-lg h-16 md:h-20 flex items-center justify-between px-4 lg:px-8">
     <div class="hidden md:flex items-center gap-3">
        <div class="w-10 h-10 bg-brand-blue rounded text-white flex items-center justify-center font-bold text-xl">R</div>
        <div>
           <h1 class="font-bold text-slate-900 leading-none">RNE VISUAL</h1>
           <p class="text-[10px] text-slate-500 font-mono">G.040 + A.010</p>
        </div>
     </div>
     
     <div class="flex w-full md:w-auto justify-around md:gap-8">
        <button onclick="nav('g040')" id="btn-g040" class="nav-btn flex flex-col md:flex-row items-center gap-1 text-slate-400 hover:text-brand-blue transition p-2">
           <i class="fa-solid fa-book-open text-xl md:text-lg"></i>
           <span class="text-[10px] md:text-sm font-bold">Glosario</span>
        </button>
        <button onclick="nav('a010')" id="btn-a010" class="nav-btn flex flex-col md:flex-row items-center gap-1 text-slate-400 hover:text-brand-blue transition p-2">
           <i class="fa-solid fa-ruler-combined text-xl md:text-lg"></i>
           <span class="text-[10px] md:text-sm font-bold">Diseño A.010</span>
        </button>
        <button onclick="nav('info')" id="btn-info" class="nav-btn flex flex-col md:flex-row items-center gap-1 text-slate-400 hover:text-brand-blue transition p-2">
           <i class="fa-solid fa-circle-info text-xl md:text-lg"></i>
           <span class="text-[10px] md:text-sm font-bold">Info</span>
        </button>
     </div>
  </nav>

  <section id="view-g040" class="view-section max-w-3xl mx-auto mt-4 md:mt-24 p-4">
    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 sticky top-4 md:top-24 z-40 mb-6">
       <label class="label-box">Diccionario Normativo (G.040)</label>
       <select id="termSelector" onchange="loadTerm(this.value)" class="input-box bg-slate-50">
          <option value="">-- Buscar Término --</option>
          </select>
    </div>

    <div id="defCard" class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden hidden">
       <div class="bg-slate-900 p-6 relative">
          <span id="defCat" class="inline-block px-2 py-1 rounded bg-brand-yellow/20 text-brand-yellow text-[10px] font-bold uppercase mb-2">Concepto</span>
          <h2 id="defTitle" class="text-2xl font-bold text-white mb-1 font-heading">Título</h2>
       </div>
       <div class="p-6">
          <div id="graphicContainer" class="w-full bg-slate-50 rounded-xl border border-slate-100 mb-4 p-4 flex items-center justify-center min-h-[180px]"></div>
          <p id="defText" class="text-sm text-slate-600 leading-relaxed text-justify"></p>
       </div>
    </div>
  </section>

  <section id="view-a010" class="view-section max-w-5xl mx-auto mt-4 md:mt-24 p-4 pb-24">
    
    <div class="mb-6">
       <h2 class="text-2xl font-bold text-slate-800">Condiciones de Diseño</h2>
       <p class="text-xs text-slate-500">Herramientas de cálculo según Norma Técnica A.010</p>
    </div>

    <div class="flex overflow-x-auto gap-2 mb-6 pb-2 hide-scroll">
       <button onclick="switchTab('stair')" class="tab-btn active bg-white px-4 py-2 rounded-full border border-slate-200 text-xs font-bold whitespace-nowrap shadow-sm hover:border-brand-blue focus:bg-brand-blue focus:text-white transition">
         <i class="fa-solid fa-stairs mr-2"></i>Escaleras (Art. 23)
       </button>
       <button onclick="switchTab('park')" class="tab-btn bg-white px-4 py-2 rounded-full border border-slate-200 text-xs font-bold whitespace-nowrap shadow-sm hover:border-brand-blue focus:bg-brand-blue focus:text-white transition">
         <i class="fa-solid fa-car mr-2"></i>Estacionamientos (Art. 54)
       </button>
       <button onclick="switchTab('light')" class="tab-btn bg-white px-4 py-2 rounded-full border border-slate-200 text-xs font-bold whitespace-nowrap shadow-sm hover:border-brand-blue focus:bg-brand-blue focus:text-white transition">
         <i class="fa-regular fa-sun mr-2"></i>Pozos de Luz (Art. 19)
       </button>
    </div>

    <div id="tab-stair" class="tab-content grid md:grid-cols-12 gap-6">
       <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
          <div>
             <label class="label-box">Uso del Edificio</label>
             <select id="st_uso" onchange="calcStair()" class="input-box">
                <option value="vivienda">Vivienda (Residencial)</option>
                <option value="oficina">Oficinas / Comercio</option>
                <option value="salud">Salud / Educación</option>
                <option value="industria">Industria</option>
             </select>
          </div>
          <div class="grid grid-cols-2 gap-4">
             <div>
                <label class="label-box">Paso (m)</label>
                <input type="number" id="st_paso" value="0.25" step="0.01" oninput="calcStair()" class="input-box text-center">
             </div>
             <div>
                <label class="label-box">Contrapaso (m)</label>
                <input type="number" id="st_contra" value="0.17" step="0.01" oninput="calcStair()" class="input-box text-center">
             </div>
          </div>
          <div id="st_msg" class="text-xs p-3 rounded-lg font-bold bg-slate-50 text-slate-500 border border-slate-100">
             Validando normativa...
          </div>
       </div>
       <div class="md:col-span-8 bg-slate-900 rounded-2xl p-6 flex items-center justify-center relative min-h-[300px] border-4 border-slate-800">
          <div class="absolute top-4 left-4 text-white/50 text-[10px] font-mono">CORTE ESQUEMÁTICO</div>
          <svg id="svg_stair" viewBox="0 0 300 200" class="w-full h-full max-h-[300px] drop-shadow-2xl"></svg>
       </div>
    </div>

    <div id="tab-park" class="tab-content hidden grid md:grid-cols-12 gap-6">
       <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
          <div>
             <label class="label-box">Tipo de Usuario</label>
             <select id="pk_uso" onchange="calcPark()" class="input-box">
                <option value="privado">Privado (Vivienda/Oficina)</option>
                <option value="publico">Público (Comercial/Visita)</option>
             </select>
          </div>
          <div>
             <label class="label-box">Disposición</label>
             <select id="pk_disp" onchange="calcPark()" class="input-box">
                <option value="ind">Individual (Solo)</option>
                <option value="cont">2 Contiguos</option>
                <option value="paralelo">Paralelo a la vía</option>
             </select>
          </div>
          <div>
             <label class="label-box">Ángulo: <span id="pk_deg_val" class="text-brand-blue">90</span>°</label>
             <input type="range" id="pk_deg" min="0" max="90" step="15" value="90" oninput="calcPark()" class="w-full accent-brand-blue">
          </div>
          <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
             <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-500 font-bold">ANCHO DE VÍA</span>
                <span id="res_via" class="font-bold text-brand-red">--</span>
             </div>
             <div class="text-[10px] text-slate-400">Calle de maniobra mínima (Gráfico D)</div>
          </div>
       </div>
       <div class="md:col-span-8 bg-slate-800 rounded-2xl p-6 flex items-center justify-center relative min-h-[300px] overflow-hidden">
          <div class="absolute inset-0 grid grid-cols-12 grid-rows-12 opacity-10 pointer-events-none">
             <div class="col-span-1 border-r border-white"></div><div class="col-span-1 border-r border-white"></div>
             </div>
          <div id="pk_canvas" class="relative transition-all duration-500 border-2 border-dashed border-white/40 flex items-center justify-center bg-brand-blue/20">
             <i class="fa-solid fa-car text-white/50 text-2xl"></i>
             <div class="absolute -top-6 w-full text-center text-xs text-brand-yellow font-mono font-bold"><span id="dim_w"></span>m</div>
             <div class="absolute -left-10 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-brand-yellow font-mono font-bold"><span id="dim_l"></span>m</div>
          </div>
       </div>
    </div>

    <div id="tab-light" class="tab-content hidden grid md:grid-cols-12 gap-6">
       <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
          <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200 mb-4">
             <p class="text-[10px] text-yellow-800 leading-tight">
                <i class="fa-solid fa-triangle-exclamation mr-1"></i>
                Para viviendas en edificios multifamiliares, las dimensiones del pozo de luz se calculan en base a la altura total (H).
             </p>
          </div>
          <div>
             <label class="label-box">Altura Total de Edificación (m)</label>
             <input type="number" id="pl_h" value="15.00" oninput="calcLight()" class="input-box text-center text-lg">
          </div>
          <div class="grid grid-cols-2 gap-4 pt-4 border-t border-slate-100">
             <div class="text-center">
                <span class="block text-[10px] text-slate-400 uppercase">Lado Mínimo</span>
                <span id="res_pl_lado" class="text-2xl font-bold text-brand-blue">--</span>
             </div>
             <div class="text-center">
                <span class="block text-[10px] text-slate-400 uppercase">Área Mínima</span>
                <span id="res_pl_area" class="text-xl font-bold text-slate-600">--</span>
             </div>
          </div>
       </div>
       
       <div class="md:col-span-8 bg-white rounded-2xl p-6 flex flex-col items-center justify-center border border-slate-200">
          <div class="relative w-48 h-48 bg-sky-100 border-2 border-sky-300 flex items-center justify-center mb-4 transition-all duration-300" id="pl_box">
             <i class="fa-regular fa-sun text-4xl text-yellow-400 animate-pulse"></i>
             <div class="absolute -bottom-6 w-full text-center text-xs font-bold text-slate-500">L = H / 3</div>
          </div>
          <p class="text-xs text-slate-400 text-center max-w-sm">
             Art. 19: Para vivienda, el lado mínimo no será menor a 2.20 m ni a 1/3 de la altura del paramento más bajo.
          </p>
       </div>
    </div>

  </section>

  <script>
    /* ---- MOTOR DE NAVEGACIÓN ---- */
    function nav(viewId) {
       document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
       document.getElementById('view-' + viewId).classList.add('active');
       document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
       document.getElementById('btn-' + viewId)?.classList.add('active');
       window.scrollTo(0,0);
    }

    function switchTab(tabId) {
       document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
       document.getElementById('tab-' + tabId).classList.remove('hidden');
       
       // Calc inicial al abrir tab
       if(tabId==='stair') calcStair();
       if(tabId==='park') calcPark();
       if(tabId==='light') calcLight();
    }

    /* ---- FASE 1: GLOSARIO G.040 (DATA) ---- */
    const G040_DATA = [
      { id: "acabados", t: "Acabados", c: "Constructivo", d: "Materiales que se instalan o forman parte del recubrimiento final en una infraestructura...", icon: "fa-paint-roller" },
      { id: "accesibilidad", t: "Accesibilidad", c: "Funcional", d: "Condición de acceso que presta la infraestructura para facilitar la movilidad autónoma.", icon: "fa-wheelchair" },
      { id: "altura", t: "Altura de Edificación", c: "Dimensiones", d: "Dimensión vertical medida desde el nivel de vereda hasta el punto más alto del techo del último piso.", svg: `<svg viewBox="0 0 100 100" class="w-full h-full"><rect x="30" y="40" width="40" height="50" fill="none" stroke="#002855" stroke-width="2"/><line x1="80" y1="90" x2="80" y2="40" stroke="#DA291C" stroke-width="2" marker-end="url(#arrow)"/><text x="85" y="65" font-size="10" fill="#DA291C">H</text></svg>` },
      { id: "area_libre", t: "Área Libre", c: "Dimensiones", d: "Superficie de terreno donde no existen proyecciones de áreas techadas (salvo aleros).", icon: "fa-expand" },
      { id: "area_techada", t: "Área Techada", c: "Dimensiones", d: "Suma de las superficies techadas. Incluye muros y ductos. No incluye aleros.", icon: "fa-vector-square" },
      { id: "azotea", t: "Azotea", c: "Arquitectónico", d: "Nivel accesible encima del último techo. Puede tener uso recreativo.", icon: "fa-layer-group" },
      { id: "ducto", t: "Ducto", c: "Instalaciones", d: "Conducto técnico vertical u horizontal para instalaciones o ventilación.", icon: "fa-wind" },
      { id: "estacionamiento", t: "Estacionamiento", c: "Funcional", d: "Espacio para vehículos. Dimensiones según uso y norma A.010.", icon: "fa-car" },
      { id: "lote_esquina", t: "Lote en Esquina", c: "Urbanismo", d: "Predio en intersección de vías. Requiere ochavo de 3.00m.", icon: "fa-road" },
      { id: "muro_cortafuego", t: "Muro Cortafuego", c: "Seguridad", d: "Paramento resistente al fuego para impedir su propagación.", icon: "fa-fire" },
      { id: "ochavo", t: "Ochavo", c: "Urbanismo", d: "Recorte diagonal en esquina. Longitud mínima 3.00m.", svg: `<svg viewBox="0 0 100 100"><path d="M20 80 L80 80 L80 20" fill="none" stroke="#ccc" stroke-width="1"/><path d="M40 80 L80 80 L80 40 L40 80" fill="#002855" opacity="0.2"/><line x1="40" y1="80" x2="80" y2="40" stroke="#DA291C" stroke-width="2"/><text x="65" y="55" font-size="8" fill="#DA291C">3m</text></svg>` },
      { id: "pozo_luz", t: "Pozo de Luz", c: "Habitabilidad", d: "Espacio libre interior para iluminación y ventilación. (Ver Art. 19)", icon: "fa-sun" },
      { id: "retiro", t: "Retiro", c: "Urbanismo", d: "Distancia libre obligatoria entre límite de propiedad y edificación.", icon: "fa-arrow-right-to-bracket" },
      { id: "sotano", t: "Sótano", c: "Arquitectónico", d: "Piso bajo el suelo. Techo sobresale máx 0.50m sobre vereda.", icon: "fa-arrow-down" },
      { id: "vivienda_multi", t: "Vivienda Multifamiliar", c: "Tipología", d: "Edificio con 2 o más unidades de vivienda superpuestas.", icon: "fa-building" },
      { id: "zonificacion", t: "Zonificación", c: "Normativa", d: "Conjunto de normas que regulan uso de suelo (RDM, RDA, CZ...)", icon: "fa-map" }
    ];

    function loadTerm(id) {
       const card = document.getElementById('defCard');
       if(!id) { card.classList.add('hidden'); return; }
       
       const d = G040_DATA.find(x => x.id === id);
       document.getElementById('defCat').innerText = d.c;
       document.getElementById('defTitle').innerText = d.t;
       document.getElementById('defText').innerText = d.d;
       
       const box = document.getElementById('graphicContainer');
       if(d.svg) box.innerHTML = d.svg;
       else box.innerHTML = `<i class="fa-solid ${d.icon} text-6xl text-slate-300"></i>`;
       
       card.classList.remove('hidden');
    }

    /* ---- FASE 2: LÓGICA DE CÁLCULO A.010 ---- */

    // 1. ESCALERAS (Art. 23)
    function calcStair() {
       const uso = document.getElementById('st_uso').value;
       const P = parseFloat(document.getElementById('st_paso').value);
       const CP = parseFloat(document.getElementById('st_contra').value);
       const msg = document.getElementById('st_msg');
       
       // Reglas (RM 191-2021)
       let minP = 0.25, maxCP = 0.18;
       if(uso === 'oficina') minP = 0.28;
       if(uso === 'salud') minP = 0.30;
       if(uso === 'industria') minP = 0.25;

       // Validar
       let status = true;
       let errors = [];
       if(P < minP) { status=false; errors.push(`Paso mín ${minP}m`); }
       if(CP > maxCP) { status=false; errors.push(`Contrapaso máx ${maxCP}m`); }
       
       // Feedback UI
       if(status) {
          msg.className = "text-xs p-3 rounded-lg font-bold bg-green-50 text-green-600 border border-green-200";
          msg.innerHTML = `<i class="fa-solid fa-check mr-1"></i> CUMPLE NORMA A.010`;
       } else {
          msg.className = "text-xs p-3 rounded-lg font-bold bg-red-50 text-red-600 border border-red-200";
          msg.innerHTML = `<i class="fa-solid fa-xmark mr-1"></i> NO CUMPLE: ${errors.join(', ')}`;
       }

       // Dibujar SVG Dinámico
       const svg = document.getElementById('svg_stair');
       const scale = 300; // factor visual
       const pVis = P * scale; 
       const cpVis = CP * scale;
       
       // Color del path según estado
       const strokeColor = status ? '#FFC72C' : '#DA291C'; // Amarillo o Rojo
       
       svg.innerHTML = `
          <defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="white" stroke-opacity="0.1"/></pattern></defs>
          <rect width="100%" height="100%" fill="url(#grid)" />
          <path d="M50,150 L${50+pVis},150 L${50+pVis},${150-cpVis} L${50+pVis*2},${150-cpVis} L${50+pVis*2},${150-cpVis*2}" 
                fill="none" stroke="${strokeColor}" stroke-width="4" stroke-linecap="round" />
          <text x="${50+pVis/2}" y="170" fill="white" font-size="10" text-anchor="middle">P=${P}</text>
          <text x="${50+pVis+10}" y="${150-cpVis/2}" fill="white" font-size="10">CP=${CP}</text>
       `;
    }

    // 2. ESTACIONAMIENTOS (Art. 54)
    function calcPark() {
       const uso = document.getElementById('pk_uso').value;
       const disp = document.getElementById('pk_disp').value;
       const ang = parseInt(document.getElementById('pk_deg').value);
       
       document.getElementById('pk_deg_val').innerText = ang;
       
       // Dimensiones Cajón (Cuadro N° 03 y 04)
       let w = 2.50, l = 5.00;
       
       if(uso === 'privado') {
          if(disp === 'ind') w = 2.70;
          else if(disp === 'cont') w = 2.50;
          else if(disp === 'paralelo') { w = 2.40; l = 5.40; }
       } else { // Publico
          if(disp === 'ind') w = 3.00;
          else if(disp === 'cont') w = 2.60;
          else if(disp === 'paralelo') { w = 2.50; l = 6.00; }
       }
       
       // Calle de Maniobra (Gráfico D aprox)
       // Simplificación lógica de la tabla gráfica
       let via = 0;
       if(ang === 0) via = 3.00; // Paralelo
       else if(ang <= 30) via = 3.00;
       else if(ang <= 45) via = 3.50;
       else if(ang <= 60) via = 4.50;
       else via = (uso === 'privado') ? 5.40 : 6.00; // 90 grados

       // Render UI
       document.getElementById('dim_w').innerText = w.toFixed(2);
       document.getElementById('dim_l').innerText = l.toFixed(2);
       document.getElementById('res_via').innerText = via.toFixed(2) + " m";
       
       // Render Canvas CSS
       const canvas = document.getElementById('pk_canvas');
       canvas.style.transform = `rotate(-${90-ang}deg)`;
       canvas.style.width = (w * 40) + "px"; // escala visual
       canvas.style.height = (l * 40) + "px";
    }

    // 3. POZOS DE LUZ (Art. 19)
    function calcLight() {
       const h = parseFloat(document.getElementById('pl_h').value);
       
       // Fórmula A.010 Vivienda: L = H/3, min 2.20m
       let L = h / 3;
       if(L < 2.20) L = 2.20;
       
       let Area = L * L; // Asumiendo cuadrado regular
       
       document.getElementById('res_pl_lado').innerText = L.toFixed(2) + " m";
       document.getElementById('res_pl_area').innerText = Area.toFixed(2) + " m²";
       
       // Visual Feedback
       const box = document.getElementById('pl_box');
       const scale = Math.min(L * 20, 180); // max pixel size
       box.style.width = scale + "px";
       box.style.height = scale + "px";
    }

    // INIT
    window.onload = function() {
       // Poblar Select Glosario
       const sel = document.getElementById('termSelector');
       G040_DATA.sort((a,b)=>a.t.localeCompare(b.t)).forEach(x => {
          let o = document.createElement('option');
          o.value = x.id; o.text = x.t;
          sel.add(o);
       });
       
       // Mostrar Tab por defecto
       nav('g040');
       switchTab('stair');
    };
  </script>
</body>
</html>
