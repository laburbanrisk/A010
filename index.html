<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>RNE Visual | A.010 + G.040</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['Roboto Mono', 'monospace'] },
          colors: {
            brand: { dark: '#0f172a', blue: '#002855', red: '#DA291C', yellow: '#FFC72C', gray: '#f1f5f9' }
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
    
    /* UTILS */
    .view-section { display: none; }
    .view-section.active { display: block; animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* CUSTOM INPUTS */
    select, input { appearance: none; }
    .input-box { @apply w-full p-3 bg-white border border-slate-300 rounded-lg text-sm font-bold text-brand-blue focus:ring-2 focus:ring-brand-blue outline-none transition-shadow; }
    .label-box { @apply block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1; }

    /* NAVBAR ACTIVE STATE */
    .nav-btn.active { @apply text-brand-blue; }
    .nav-btn.active i { @apply animate-bounce; }
    
    /* TABS */
    .tab-btn { @apply bg-white px-4 py-2 rounded-full border border-slate-200 text-xs font-bold whitespace-nowrap shadow-sm hover:border-brand-blue transition text-slate-500; }
    .tab-btn.active { @apply bg-brand-blue text-white border-brand-blue shadow-md; }
    
    /* SCROLL */
    .hide-scroll::-webkit-scrollbar { display: none; }
    .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="pb-24 md:pb-0 bg-slate-100 text-slate-800">

  <nav class="fixed bottom-0 md:top-0 w-full bg-white/95 backdrop-blur z-50 border-t md:border-b border-slate-200 shadow-lg h-16 md:h-20 flex items-center justify-between px-4 lg:px-8">
     <div class="hidden md:flex items-center gap-3">
        <div class="w-10 h-10 bg-brand-blue rounded text-white flex items-center justify-center font-bold text-xl">R</div>
        <div>
           <h1 class="font-bold text-slate-900 leading-none">RNE VISUAL</h1>
           <p class="text-[10px] text-slate-500 font-mono">G.040 + A.010</p>
        </div>
     </div>
     
     <div class="flex w-full md:w-auto justify-around md:gap-8">
        <button onclick="nav('g040')" id="btn-g040" class="nav-btn flex flex-col md:flex-row items-center gap-1 text-slate-400 hover:text-brand-blue transition p-2">
           <i class="fa-solid fa-book-open text-xl md:text-lg"></i>
           <span class="text-[10px] md:text-sm font-bold">Glosario</span>
        </button>
        <button onclick="nav('a010')" id="btn-a010" class="nav-btn flex flex-col md:flex-row items-center gap-1 text-slate-400 hover:text-brand-blue transition p-2">
           <i class="fa-solid fa-ruler-combined text-xl md:text-lg"></i>
           <span class="text-[10px] md:text-sm font-bold">Diseño A.010</span>
        </button>
     </div>
  </nav>

  <section id="view-g040" class="view-section max-w-3xl mx-auto mt-4 md:mt-24 p-4">
    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 sticky top-4 md:top-24 z-40 mb-6">
       <label class="label-box">Diccionario Normativo (G.040)</label>
       <select id="termSelector" onchange="loadTerm(this.value)" class="input-box bg-slate-50">
          <option value="">-- Buscar Término --</option>
          </select>
    </div>

    <div id="defCard" class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden hidden">
       <div class="bg-slate-900 p-6 relative">
          <span id="defCat" class="inline-block px-2 py-1 rounded bg-brand-yellow/20 text-brand-yellow text-[10px] font-bold uppercase mb-2">Concepto</span>
          <h2 id="defTitle" class="text-2xl font-bold text-white mb-1 font-heading">Título</h2>
       </div>
       <div class="p-6">
          <div id="graphicContainer" class="w-full bg-slate-50 rounded-xl border border-slate-100 mb-4 p-4 flex items-center justify-center min-h-[180px]"></div>
          <p id="defText" class="text-sm text-slate-600 leading-relaxed text-justify"></p>
       </div>
    </div>
  </section>

  <section id="view-a010" class="view-section max-w-6xl mx-auto mt-4 md:mt-24 p-4 pb-24">
    
    <div class="mb-6">
       <h2 class="text-2xl font-bold text-slate-800">Calculadora Normativa A.010</h2>
       <p class="text-xs text-slate-500">Herramientas de validación de espacios y circulaciones.</p>
    </div>

    <div class="flex overflow-x-auto gap-2 mb-6 pb-2 hide-scroll">
       <button onclick="switchTab('pasajes')" class="tab-btn active"><i class="fa-solid fa-person-walking mr-2"></i>Pasajes</button>
       <button onclick="switchTab('escaleras')" class="tab-btn"><i class="fa-solid fa-stairs mr-2"></i>Escaleras (5 Pisos)</button>
       <button onclick="switchTab('estaciona')" class="tab-btn"><i class="fa-solid fa-car mr-2"></i>Estacionamientos</button>
       <button onclick="switchTab('ductos')" class="tab-btn"><i class="fa-solid fa-wind mr-2"></i>Ductos y Luz</button>
    </div>

    <div id="tab-pasajes" class="tab-content grid md:grid-cols-12 gap-6">
        <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
            <div>
                <label class="label-box">Uso del Pasaje (Art. 20)</label>
                <select id="pas_uso" onchange="calcPasaje()" class="input-box">
                    <option value="viv_int">Vivienda (Interior)</option>
                    <option value="viv_com">Vivienda (Área Común)</option>
                    <option value="oficina">Oficinas / Comercio</option>
                    <option value="salud">Salud (Pacientes)</option>
                    <option value="edu">Educación</option>
                </select>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-center">
                <span class="block text-[10px] text-slate-500 uppercase">Ancho Mínimo Requerido</span>
                <span id="pas_res" class="text-3xl font-bold text-brand-blue">0.90 m</span>
            </div>
        </div>
        <div class="md:col-span-8 bg-slate-100 rounded-2xl p-6 flex flex-col items-center justify-center relative border border-slate-200">
            <div class="relative h-64 bg-slate-300 border-x-4 border-slate-500 shadow-inner flex items-end justify-center transition-all duration-500" id="pas_box" style="width: 180px;">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-slate-400 opacity-20 text-6xl">
                    <i class="fa-solid fa-arrows-left-right"></i>
                </div>
                <i class="fa-solid fa-person text-6xl text-brand-blue mb-4 drop-shadow-lg"></i>
                <div class="absolute -top-8 w-full border-b border-slate-800 text-center">
                    <span id="pas_cota" class="bg-slate-100 px-2 text-xs font-bold font-mono">0.90m</span>
                </div>
            </div>
            <p class="mt-4 text-[10px] text-slate-500 max-w-md text-center">
                *Dimensiones libres entre paramentos. No incluye elementos salientes como columnas (máx 15cm).
            </p>
        </div>
    </div>

    <div id="tab-escaleras" class="tab-content hidden grid md:grid-cols-12 gap-6">
        <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4 h-fit">
            <h3 class="text-xs font-bold text-brand-blue uppercase border-b border-slate-100 pb-2">Configuración</h3>
            <div>
                <label class="label-box">Tipo de Escalera</label>
                <select id="esc_tipo" onchange="calcEscalera()" class="input-box">
                    <option value="integrada">Integrada (Abierta)</option>
                    <option value="b1">Protegida (Vestíbulo B1)</option>
                    <option value="b2">Presurizada (B2)</option>
                </select>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="label-box">Pisos</label>
                    <select id="esc_pisos" onchange="calcEscalera()" class="input-box text-center">
                        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option><option value="5" selected>5</option>
                    </select>
                </div>
                <div>
                    <label class="label-box">Altura Piso (m)</label>
                    <input type="number" id="esc_h" value="2.70" step="0.05" onchange="calcEscalera()" class="input-box text-center">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="label-box">Paso (m)</label>
                    <input type="number" id="esc_p" value="0.25" step="0.01" onchange="calcEscalera()" class="input-box text-center">
                </div>
                <div>
                    <label class="label-box">Ancho Tramo (m)</label>
                    <input type="number" id="esc_ancho" value="1.20" step="0.10" onchange="calcEscalera()" class="input-box text-center">
                </div>
            </div>
            
            <div class="bg-brand-gray p-3 rounded-lg border border-slate-200 text-xs space-y-2">
                <div class="flex justify-between"><span>Contrapaso Calc:</span> <span id="res_cp" class="font-bold">--</span></div>
                <div class="flex justify-between"><span>Pasos x Piso:</span> <span id="res_steps" class="font-bold">--</span></div>
                <div class="flex justify-between"><span>Long. en Planta:</span> <span id="res_long" class="font-bold text-brand-blue">--</span></div>
            </div>
        </div>

        <div class="md:col-span-8 bg-slate-900 rounded-2xl p-6 relative min-h-[500px] border-4 border-slate-800 flex flex-col">
            <div class="absolute top-4 left-4 text-white/50 text-[10px] font-mono z-10">SIMULACIÓN DE SECCIÓN (CORTE)</div>
            
            <div class="flex-1 overflow-y-auto custom-scroll flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/blueprint-grid.png')]">
                <svg id="svg_stair" class="w-full h-full min-h-[400px]" preserveAspectRatio="xMidYMid meet"></svg>
            </div>
        </div>
    </div>

    <div id="tab-estaciona" class="tab-content hidden grid md:grid-cols-12 gap-6">
        <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
            <div>
             <label class="label-box">Tipo de Usuario</label>
             <select id="pk_uso" onchange="calcPark()" class="input-box">
                <option value="privado">Privado (Vivienda/Oficina)</option>
                <option value="publico">Público (Comercial/Visita)</option>
             </select>
          </div>
          <div>
             <label class="label-box">Disposición</label>
             <select id="pk_disp" onchange="calcPark()" class="input-box">
                <option value="ind">Individual (Solo)</option>
                <option value="cont">2 Contiguos</option>
                <option value="paralelo">Paralelo a la vía</option>
             </select>
          </div>
          <div>
             <label class="label-box">Ángulo: <span id="pk_deg_val" class="text-brand-blue">90</span>°</label>
             <input type="range" id="pk_deg" min="0" max="90" step="15" value="90" oninput="calcPark()" class="w-full accent-brand-blue">
          </div>
          <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
             <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-500 font-bold">ANCHO DE VÍA</span>
                <span id="res_via" class="font-bold text-brand-red">--</span>
             </div>
             <div class="text-[10px] text-slate-400">Calle de maniobra mínima (Gráfico D)</div>
          </div>
        </div>
        <div class="md:col-span-8 bg-slate-800 rounded-2xl p-6 flex items-center justify-center relative min-h-[300px] overflow-hidden">
             <div id="pk_canvas" class="relative transition-all duration-500 border-2 border-dashed border-white/40 flex items-center justify-center bg-brand-blue/20">
                 <i class="fa-solid fa-car text-white/50 text-2xl"></i>
                 <div class="absolute -top-6 w-full text-center text-xs text-brand-yellow font-mono font-bold"><span id="dim_w"></span>m</div>
                 <div class="absolute -left-10 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-brand-yellow font-mono font-bold"><span id="dim_l"></span>m</div>
             </div>
        </div>
    </div>

    <div id="tab-ductos" class="tab-content hidden grid md:grid-cols-12 gap-6">
        <div class="md:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-4">
            <div>
                <label class="label-box">Tipo de Espacio</label>
                <select id="duc_tipo" onchange="calcDucto()" class="input-box">
                    <option value="luz">Pozo de Luz (Iluminación)</option>
                    <option value="vent_mec">Ventilación Mecánica (Ducto)</option>
                </select>
            </div>
            <div>
                <label class="label-box">Altura Edificación (m)</label>
                <input type="number" id="duc_h" value="15.00" oninput="calcDucto()" class="input-box text-center">
            </div>
            
            <div id="res_ducto_box" class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 text-center">
                <span class="block text-[10px] text-slate-500 uppercase">Lado Mínimo (Art. 19)</span>
                <span id="res_duc_lado" class="text-3xl font-bold text-brand-blue">--</span>
                <div class="text-xs text-slate-500 mt-2">Área Mín: <span id="res_duc_area" class="font-bold">--</span></div>
            </div>
        </div>
        
        <div class="md:col-span-8 bg-white rounded-2xl p-6 flex flex-col items-center justify-center border border-slate-200">
             <div class="relative transition-all duration-500 border-4 border-slate-800 bg-sky-100 flex items-center justify-center shadow-inner" id="duc_visual" style="width: 200px; height: 200px;">
                 <i class="fa-regular fa-sun text-4xl text-yellow-500 animate-pulse" id="duc_icon"></i>
                 <div class="absolute -bottom-8 w-full text-center text-xs font-mono font-bold text-slate-600">L = <span id="visual_l"></span>m</div>
             </div>
             <p class="mt-10 text-[10px] text-slate-400 italic text-center">
                 "Para viviendas en edificaciones multifamiliares, las dimensiones del pozo de luz se calculan en base a la altura total de la edificación."
             </p>
        </div>
    </div>

  </section>

  <script>
    /* -----------------------------------
       1. SISTEMA DE NAVEGACIÓN
       ----------------------------------- */
    function nav(viewId) {
       document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
       document.getElementById('view-' + viewId).classList.add('active');
       document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
       document.getElementById('btn-' + viewId)?.classList.add('active');
    }

    function switchTab(tabId) {
       document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
       document.getElementById('tab-' + tabId).classList.remove('hidden');
       document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
       event.currentTarget.classList.add('active');
       
       // Trigger recalcs
       if(tabId==='pasajes') calcPasaje();
       if(tabId==='escaleras') calcEscalera();
       if(tabId==='estaciona') calcPark();
       if(tabId==='ductos') calcDucto();
    }

    /* -----------------------------------
       2. FASE 1: GLOSARIO G.040 (DATA)
       ----------------------------------- */
    const G040_DATA = [
      { id: "acabados", t: "Acabados", c: "Constructivo", d: "Materiales que se instalan o forman parte del recubrimiento final en una infraestructura...", icon: "fa-paint-roller" },
      { id: "accesibilidad", t: "Accesibilidad", c: "Funcional", d: "Condición de acceso que presta la infraestructura para facilitar la movilidad autónoma.", icon: "fa-wheelchair" },
      { id: "altura", t: "Altura de Edificación", c: "Dimensiones", d: "Dimensión vertical medida desde el nivel de vereda hasta el punto más alto del techo del último piso.", svg: `<svg viewBox="0 0 100 100" class="w-full h-full"><rect x="30" y="40" width="40" height="50" fill="none" stroke="#002855" stroke-width="2"/><line x1="80" y1="90" x2="80" y2="40" stroke="#DA291C" stroke-width="2" marker-end="url(#arrow)"/><text x="85" y="65" font-size="10" fill="#DA291C">H</text></svg>` },
      { id: "area_libre", t: "Área Libre", c: "Dimensiones", d: "Superficie de terreno donde no existen proyecciones de áreas techadas (salvo aleros).", icon: "fa-expand" },
      { id: "area_techada", t: "Área Techada", c: "Dimensiones", d: "Suma de las superficies techadas. Incluye muros y ductos. No incluye aleros.", icon: "fa-vector-square" },
      { id: "azotea", t: "Azotea", c: "Arquitectónico", d: "Nivel accesible encima del último techo. Puede tener uso recreativo.", icon: "fa-layer-group" },
      { id: "ducto", t: "Ducto", c: "Instalaciones", d: "Conducto técnico vertical u horizontal para instalaciones o ventilación.", icon: "fa-wind" },
      { id: "estacionamiento", t: "Estacionamiento", c: "Funcional", d: "Espacio para vehículos. Dimensiones según uso y norma A.010.", icon: "fa-car" },
      { id: "lote_esquina", t: "Lote en Esquina", c: "Urbanismo", d: "Predio en intersección de vías. Requiere ochavo de 3.00m.", icon: "fa-road" },
      { id: "muro_cortafuego", t: "Muro Cortafuego", c: "Seguridad", d: "Paramento resistente al fuego para impedir su propagación.", icon: "fa-fire" },
      { id: "ochavo", t: "Ochavo", c: "Urbanismo", d: "Recorte diagonal en esquina. Longitud mínima 3.00m.", svg: `<svg viewBox="0 0 100 100"><path d="M20 80 L80 80 L80 20" fill="none" stroke="#ccc" stroke-width="1"/><path d="M40 80 L80 80 L80 40 L40 80" fill="#002855" opacity="0.2"/><line x1="40" y1="80" x2="80" y2="40" stroke="#DA291C" stroke-width="2"/><text x="65" y="55" font-size="8" fill="#DA291C">3m</text></svg>` },
      { id: "pozo_luz", t: "Pozo de Luz", c: "Habitabilidad", d: "Espacio libre interior para iluminación y ventilación. (Ver Art. 19)", icon: "fa-sun" },
      { id: "retiro", t: "Retiro", c: "Urbanismo", d: "Distancia libre obligatoria entre límite de propiedad y edificación.", icon: "fa-arrow-right-to-bracket" },
      { id: "sotano", t: "Sótano", c: "Arquitectónico", d: "Piso bajo el suelo. Techo sobresale máx 0.50m sobre vereda.", icon: "fa-arrow-down" },
      { id: "vivienda_multi", t: "Vivienda Multifamiliar", c: "Tipología", d: "Edificio con 2 o más unidades de vivienda superpuestas.", icon: "fa-building" },
      { id: "zonificacion", t: "Zonificación", c: "Normativa", d: "Conjunto de normas que regulan uso de suelo (RDM, RDA, CZ...)", icon: "fa-map" }
    ];

    function loadTerm(id) {
       const card = document.getElementById('defCard');
       if(!id) { card.classList.add('hidden'); return; }
       const d = G040_DATA.find(x => x.id === id);
       document.getElementById('defCat').innerText = d.c;
       document.getElementById('defTitle').innerText = d.t;
       document.getElementById('defText').innerText = d.d;
       const box = document.getElementById('graphicContainer');
       if(d.svg) box.innerHTML = d.svg;
       else box.innerHTML = `<i class="fa-solid ${d.icon} text-6xl text-slate-300"></i>`;
       card.classList.remove('hidden');
    }

    /* -----------------------------------
       3. FASE 2: CALCULADORAS A.010
       ----------------------------------- */
       
    // --- CALC 1: PASAJES ---
    function calcPasaje() {
        const uso = document.getElementById('pas_uso').value;
        let w = 0.90;
        
        // Reglas Art. 20
        if(uso === 'viv_int') w = 0.90;
        else if(uso === 'viv_com') w = 1.20;
        else if(uso === 'oficina') w = 1.20;
        else if(uso === 'salud') w = 1.80; // A.050 requiere min 1.80 a 2.20
        else if(uso === 'edu') w = 1.20;

        document.getElementById('pas_res').innerText = w.toFixed(2) + " m";
        document.getElementById('pas_cota').innerText = w.toFixed(2) + " m";
        
        // Animar caja
        const box = document.getElementById('pas_box');
        const scale = w * 200; // Factor visual
        box.style.width = Math.min(Math.max(scale, 100), 300) + "px";
    }

    // --- CALC 2: ESCALERAS MULTINIVEL ---
    function calcEscalera() {
        const pisos = parseInt(document.getElementById('esc_pisos').value);
        const h = parseFloat(document.getElementById('esc_h').value);
        const p = parseFloat(document.getElementById('esc_p').value);
        const ancho = parseFloat(document.getElementById('esc_ancho').value);
        const tipo = document.getElementById('esc_tipo').value;

        // Cálculos Matemáticos
        // 1. Número de contrapasos (CP) por piso
        // Regla: CP max 0.18. Buscamos entero superior.
        const numCP = Math.ceil(h / 0.18);
        const realCP = h / numCP;
        const numPasos = numCP - 1;
        
        // 2. Longitud horizontal por tramo (asumiendo lineal para esquema)
        // Incluye descanso de 1.20m por norma si son más de 17 pasos (aquí simplificado por piso)
        const longHuella = numPasos * p;
        const descanso = 1.20; 
        const totalLong = longHuella + descanso;

        // Render Datos
        document.getElementById('res_cp').innerText = realCP.toFixed(3) + " m";
        document.getElementById('res_steps').innerText = numPasos;
        document.getElementById('res_long').innerText = totalLong.toFixed(2) + " m";

        // GENERACIÓN GRÁFICO SVG (EDIFICIO)
        const svg = document.getElementById('svg_stair');
        const scaleX = 40; // Pixels por metro X
        const scaleY = 40; // Pixels por metro Y
        
        let svgContent = `<defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#ffffff" stroke-opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="#0f172a"/>`;
        
        // Dibujar cada piso
        let currentY = 50; // Margen superior
        let startX = 50;
        
        // Altura total edificio visual
        const totalHVisual = pisos * h * scaleY;
        svg.setAttribute('viewBox', `0 0 ${startX + totalLong*scaleX + 100} ${totalHVisual + 100}`);

        for(let i = pisos; i >= 1; i--) {
             let floorY = (pisos - i + 1) * h * scaleY + 20;
             
             // Línea de Piso
             svgContent += `<line x1="20" y1="${floorY}" x2="${startX + totalLong*scaleX + 50}" y2="${floorY}" stroke="#334155" stroke-width="2"/>`;
             svgContent += `<text x="25" y="${floorY - 5}" fill="#64748b" font-size="10" font-family="monospace">NIVEL ${i}</text>`;
             
             // Dibujar Escalera (Zig Zag simplificado)
             // Start Point (Abajo) -> End Point (Arriba)
             let x1 = startX;
             let y1 = floorY;
             let x2 = startX + longHuella * scaleX;
             let y2 = floorY - (h * scaleY);
             
             // Color según tipo
             let color = (tipo === 'integrada') ? '#FFC72C' : (tipo === 'b1' ? '#38bdf8' : '#DA291C');
             
             // Rampa visual simplificada para escala macro
             svgContent += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-width="4" stroke-linecap="round"/>`;
             
             // Descanso
             svgContent += `<line x1="${x2}" y1="${y2}" x2="${x2 + descanso*scaleX}" y2="${y2}" stroke="${color}" stroke-width="4"/>`;
             
             // Baranda
             svgContent += `<line x1="${x1}" y1="${y1-10}" x2="${x2}" y2="${y2-10}" stroke="white" stroke-width="1" stroke-opacity="0.5" stroke-dasharray="4,2"/>`;
             
             // Conexión vertical si no es el último
             if(i > 1) {
                 // Linea punteada de retorno
                 svgContent += `<line x1="${x2 + descanso*scaleX}" y1="${y2}" x2="${startX}" y2="${y2}" stroke="#475569" stroke-width="1" stroke-dasharray="2,2"/>`;
             }
        }
        
        svg.innerHTML = svgContent;
    }

    // --- CALC 3: ESTACIONAMIENTOS ---
    function calcPark() {
       const uso = document.getElementById('pk_uso').value;
       const disp = document.getElementById('pk_disp').value;
       const ang = parseInt(document.getElementById('pk_deg').value);
       document.getElementById('pk_deg_val').innerText = ang;
       
       let w = 2.50, l = 5.00;
       if(uso === 'privado') {
          if(disp === 'ind') w = 2.70;
          else if(disp === 'cont') w = 2.50;
          else if(disp === 'paralelo') { w = 2.40; l = 5.40; }
       } else { 
          if(disp === 'ind') w = 3.00;
          else if(disp === 'cont') w = 2.60;
          else if(disp === 'paralelo') { w = 2.50; l = 6.00; }
       }
       
       let via = 0;
       if(ang === 0) via = 3.00; 
       else if(ang <= 30) via = 3.00;
       else if(ang <= 45) via = 3.50;
       else if(ang <= 60) via = 4.50;
       else via = (uso === 'privado') ? 5.40 : 6.00;

       document.getElementById('dim_w').innerText = w.toFixed(2);
       document.getElementById('dim_l').innerText = l.toFixed(2);
       document.getElementById('res_via').innerText = via.toFixed(2) + " m";
       
       const canvas = document.getElementById('pk_canvas');
       canvas.style.transform = `rotate(-${90-ang}deg)`;
       canvas.style.width = (w * 35) + "px";
       canvas.style.height = (l * 35) + "px";
    }

    // --- CALC 4: DUCTOS ---
    function calcDucto() {
        const tipo = document.getElementById('duc_tipo').value;
        const h = parseFloat(document.getElementById('duc_h').value);
        
        let L = 0;
        let icon = "fa-sun";
        let color = "text-yellow-500";
        
        if(tipo === 'luz') {
            // Art. 19: H/3 min 2.20
            L = h / 3;
            if(L < 2.20) L = 2.20;
        } else {
            // Ventilación mecánica (Referencial EM.030)
            L = 1.20; // Valor std mínimo constructivo referencial
            icon = "fa-fan";
            color = "text-slate-500";
        }
        
        const area = L * L;
        
        document.getElementById('res_duc_lado').innerText = L.toFixed(2) + " m";
        document.getElementById('res_duc_area').innerText = area.toFixed(2) + " m²";
        document.getElementById('visual_l').innerText = L.toFixed(2);
        
        // Update Visual
        const box = document.getElementById('duc_visual');
        const i = document.getElementById('duc_icon');
        const scale = Math.min(L * 25, 250);
        
        box.style.width = scale + "px";
        box.style.height = scale + "px";
        i.className = `fa-regular ${icon} text-4xl ${color} animate-pulse`;
    }

    // INIT
    window.onload = function() {
       // Poblar Glosario
       const sel = document.getElementById('termSelector');
       G040_DATA.sort((a,b)=>a.t.localeCompare(b.t)).forEach(x => {
          let o = document.createElement('option'); o.value = x.id; o.text = x.t; sel.add(o);
       });
       // Defaults
       nav('a010');
       switchTab('escaleras');
    };
  </script>
</body>
</html>
